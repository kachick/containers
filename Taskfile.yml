# https://taskfile.dev

version: '3'

tasks:
  default:
    deps:
      - task: fmt
      - task: lint
      - task: test
  check:
    deps:
      - task: test
      - task: lint
  test:
    cmds:
      - echo 'Update here'
  fmt:
    cmds:
      - dprint fmt
      - nixpkgs-fmt ./*.nix
  lint:
    cmds:
      - dprint check
      - typos . .github .vscode
      - nixpkgs-fmt --check ./*.nix
      - trivy config .
  try:
    cmds:
      - podman build --tag {{.IMAGE}} --build-arg username={{.USER}} --file ./images/{{.IMAGE}}/Containerfile .
      - podman run --rm --name {{.IMAGE}} --detach {{.IMAGE}}
      - podman exec --user {{.USER}} --interactive --tty {{.IMAGE}} bash
      - podman stop {{.IMAGE}}
  deps:
    cmds:
      - nix --version
      - nil --version
      - task --version
      - dprint --version
      - typos --version
      - trivy --version
